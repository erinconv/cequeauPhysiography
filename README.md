# cequeauPhysiography

---

The CEQUEAU Physiography Toolbox: A Toolbox for extracting and assembling the physiographic data necessary to run the CEQUEAU hydrological model

---

The CEQUEAUphysiography Toolbox is designed to speed up and automate the extraction of flow routing and land use data necessary to run the CEQUEAU model, a coupled hydrological – water temperature model maintained by the Institut National de la Recherche Scientifique, Québec, Canada (http://ete.inrs.ca/ete/publications/cequeau-hydrological-model).  A detailed summary of the CEQUEAU model is given in:

Morin, G., & Couillard, D. (1990). Chapter 5: Predicting river temperatures with a hydrological model. In N. Cheremisinoff (Ed.), Encyclopedia of Fluid Mechanics: Surface and Groundwater Flow Phenomena (pp. 171-209). Houston, TX: Gulf Publishing

In the past, the extraction of physiographic data necessary to run the CEQUEAU model was relatively laborious, particularly with regards to computing the flow routing between model grid squares squares (CEs) and partial squares (CPs).  The CEQUEAUphysiography Toolbox uses a combination of ArcGIS and Matlab to complete this task with a minimum of user input, allowing for the physiography data to be extracting relatively simply.  This readme file contains a simple description of each Matlab function within the toolbox.  Please refer to the accompanying workflow guide for more information about generating a CEQUEAU ‘bassinVersant’ structure compatible with the x64 Matlab implementation of CEQUEAU using the CEQUEAUphysiography Toolbox.

IMPORTANT! Much more detail about all of functions detailed below is given in the comments for each function.  The CEQUEAU_physiography.m master function also contains a step-by-step list of the order in which each function should be applied and a short explanation of what occurs at each step of the physiography processing workflow!

---

CEQUEAU_physiography.m 
Generates CEQUEAU bassinVersant physiography data structure.

Master function that controls sub functions (explained below) to generate CEQUEAU physiography data for bassinVersant structure.  

---

createCEgrid.m
Generates CEQUEAU CE raster

Generates a raster image of CEs from a fishnet shapefile produced using the 'fishnet' function in ArcGIS.  

---

createCPgrid.m
Generates CEQUEAU CP raster

Generates a raster image of CPs by intersecting the CE raster with a catchment grid raster generated by ArcHydro tools

---

do4CPs.m
Ensures no more than 4 CPs per CE when calculating CEQUEAU routing

For CEs containing more than 4 CPs, this function merges the smallest CPs with adjoining CPs.  Uses Arc Hydro flow accumulation raster to ensure that 
this merging process is done in a hydrologically correct manner. This function forces 4 CPs per CE, and may very occasionally cause circular flow routing problems.

---

doCEcoordinates.m
Extracts the i and j coordinates for all CEs and CPs

Uses the CE raster to assign i,j coordinates to each CE and CP within the watershed.

---

doCProuting.m
Computes flow routing from each CP into the next

Uses the Arc Hydro flow accumulation raster to determine flow routing between CPs by identifying the outlet of each CP and the next CP into which it drains.

---

doImpermeableSurface.m
Extracts impermeable surface fraction for CEs

Uses the CE raster and a land cover map to determine the fraction of each CE that is impermeable. Land cover map must be downloaded from the North American Land Change Monitoring System Land Cover 2010 database: http://www.cec.org/Page.asp?PageID=924&ContentID=2819&AA_SiteLanguageID=1

---

doLacs.m
Creates binary vector of big lake presence or absence

---

Creates a 'lac' vector for use in CEQUEAU inputStruct.parametres.lac containing binary 1s where a large lake (defined as a lake that extends over more than one CP) is present and 0s when there are no lakes

---

doMeteoStation.m
Assembles met station data for watershed.
  
Uses CE raster and 'metStations' structure from meteoStationData.m function (see /meteo folder) to assemble stations and meteoStation sub-structures for CEQUEAU

---

doRasterLandCover.m
Extracts raster land cover data for CEs and CPs

Uses the CP and CE rasters and a land cover map to assemble land cover data (forest cover, bare soil) for the watershed.  Land cover map must be downloaded from the North American Land Change Monitoring System Land Cover 2010 database: http://www.cec.org/Page.asp?PageID=924&ContentID=2819&AA_SiteLanguageID=1

---

doRoutingTable.m
Renumbers initial CPs based on routing flow routing and generates new routing table.

Uses the 'routing' variable from doCProuting.m function to generate a
new routing table.  CPs are renumbered based on their position upstream (ie. the downstream-most CP is CP1).  All CPs immediately upstream of Nth CP are then entered into the routing table.

---

doVectorLandCover.m
Extracts vector land cover data for CEs and CPs

Uses the CP/CE rasters and a shapefile of a given land cover class (eg. water bodies, wetlands) to compute the percentage that that land cover class contributes to CPs/CEs.

---

getAltitudes.m
Extracts altitude data for all CEs and CPs

Uses a DEM of the watershed to extract altitude data for the CEs and CPs (bottom left corner of CE for CEs and mean altitude for CPs.

---

getCPareas.m
%GETCPAREAS Computes percentage surface area stats for each CP

Loops through CPs and calculates size of each CP.  Then calculates this as a percentage of its containing CE.

---

getCumulCPareas.m
Computes cumulative upstream percentage surface area stats for each CP

Calculates cumulative upstream percentage area of all upstream CPs.

---

getCumulLandCover.m
Computes cumulative percentage land cover stats for each CP

Calculates cumulative upstream percentage area of for a given land cover class

---

getDownstreamCPs.m
Renumbers CPs based on routing, generates new routing table

Uses the output from doRoutingTable.m function to identify the CP immediately downstream of each CP

---

ismember_fast.m
Much faster version of Matlab ismember.m function.

---

outletRoutes.m
Calculates routes from Nth CP to basin outlet

Computes the downstream route (CP by CP) from each CP to the watershed mouth using the outputs of the doRoutingTable.m and getDownstreamCPs.m functions.

---

populateStructs.m
Populates CP and CE structures with data

Populates carreauxPartiels and carreauxEntiers sub-structures of bassinVersant sub-structure using data generated by CEQUEAU_physiography.m function

---

redoCEgrid.m
Renumbers CE raster based on routing table

Uses the outputs from doRoutingTable.m and getCPareas.m to renumber the CE raster.

---

redoCPgrid.m
Renumbers CPgrid based on routing table (rtable)

Uses the outputs from doRoutingTable.m to renumber CP raster.  CPs are renumbered based on their position upstream (ie. the downstream-most CP is CP1).

---

removeCPsegments.m
Removes small CP segments and merges with large CPs

Removes extremely small CP segments from CP raster (segments less than 1% of CE size) and merges them with adjoining CPs.  Uses Arc Hydro flow accumulation raster to ensure that this merging is done in a hydrologically correct manner.  This helps to ensure 4 CPs per CE.







